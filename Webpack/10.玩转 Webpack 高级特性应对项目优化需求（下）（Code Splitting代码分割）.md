## 十、玩转 Webpack 高级特性应对项目优化需求（下）（Code Splitting 代码分割/分包）

### webpack all-in-one 的弊端

所有的代码都打包到一个文件夹中导致的问题：**打包结果过大**，初始用应用时需要全部加载进来，**加载过慢，应用响应速度过慢，浪费流量和带宽**；http1.1 本身也存在一些缺陷；
合理性：**将打包结果根据一定的规则分离到多个 bundle 中**，再**根据应用运行的需要按需加载**，降低启用成本，提高响应速度。

### Code Splitting

#### 作用：通过把项目中的资源模块按照我们设计的规则打包到不同的 bundle 中，降低应用的启动成本，提高响应速度。

#### 实现分包的方式：

##### 1、根据业务不同配置多个打包入口，输出多个打包结果；

适用于：**多页应用程序**。

常见的划分规则：**一个页面对应一个打包入口；对于不同页面间的公共部分，提取到公共的结果中**。

设置方式：多个入口：entry；多个出口：output（可以使用 **name 入口名称**生成多个出口文件名）；生成多个 html：HtmlWebpackPlugin；

问题1：每个 html 都引入了所有的模块。
解决：在使用 HtmlWebpackPlugin 时指定 chunks 为需要引入的 chunk。

问题2：不同的入口中一定会存在公共的模块；
解决：提取公共模块：`optimization: { splitChunks: { chunks: all } }`；（自动提取所有的公共模块到单独的 bundle 中）

##### 2、结合 ES Modules 的动态导入特性（Dynamic Imports），按需加载模块；（更常见）

此处的**按需加载**：在应用运行过程中，需要用到某个资源模块时才去加载这个模块。（更灵活）（惰性加载）

import 语句 -> import 函数（返回 promise 对象）

魔法注释：/* webpackChunkName: '<chunk-name>' */
(相同的 chunkName 会被打包到同一个文件中。)


