## 八、如何让你的模块支持热替换（HMR）机制

### 自动刷新带来的问题：页面中输入但是没有保存到服务器的文本在浏览器自动刷新后就丢失了。
- 在代码中写死文本；
- 使用代码将数据/状态保存在 localStorage 中，刷新过后再取回来；
（太麻烦，不够灵活。）

### 模块热替换（HMR）：在应用的运行过程中实时去替换其中的某个模块，应用的运行状态不会因为这个操作而发生变化。

（热拔插：在运行过程中的即时变化。）

作用：
体验：

#### 开启 HMR：模块已经集成在 webpack 中，不需要单独安装；

两种方式：
1.在运行 `webpack-dev-server` 命令时，通过 `--hot` 参数去开启这个特性；

2.在配置文件中配置：`devServer：hot：true`；载入一个内置插件 `HotModuleReplacementPlugin`；

#### 简单开启存在的问题：

- 样式文件可以热更新，js文件不行；（需要手动配置）
- 为什么样式文件可以热更新，js文件不行；（js 的不确定性非常多）
- 框架脚手架为啥没有那么多问题（create-react-app / vue-cli)；（工具内部处理了替换操作）

#### 热替换的状态保持：（js 模块）

HMR APIs:`module.hot.accept('./hmr', function() {})`

#### 图片模块热替换：直接替换 src；

#### 使用过程常见的问题：

1.热替换处理函数中存在错误，会导致页面自动刷新，HMR 会失效且看不到异常；
问题解决：使用 hotOnly：只使用热替换，不会回退到使用自动刷新。
2.再没有载入 HMR 插件时使用 module.hot.accept 会报错；
原因：module.hot 是 HMR 提供的成员。
问题解决：先判断 module.hot 是否存在。
3.HMR 相关代码是否会对生产环境产生影响（生产环境一般不会开启热替换）；
查看:bundle.js 在生产环境中移除了 HMR 相关代码。

#### 框架的 HMR：
- react 的 HMR 方案；
- vue 的 HMR 方案；
